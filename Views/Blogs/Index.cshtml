@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@model IEnumerable<BlogApp.Models.Blog>
@{
    ViewData["Title"] = "All Blogs";
}

<div class="container py-4">
    <h1>@ViewData["Title"]</h1>

    <p>
        <a asp-action="Create" class="btn btn-primary">Create New Blog</a>
    </p>

    <div class="mb-3">
        <div class="btn-group" role="group">
            @{
                var sortOptions = new Dictionary<string, string>
                {
                    { ViewBag.NameSortParam, "Title " + (ViewBag.NameSortParam == "name_desc" ? "Z-A" : "A-Z") },
                    { ViewBag.PostsSortParam, "Posts " + (ViewBag.PostsSortParam == "posts_desc" ? "↑" : "↓") }
                };
            }

            @foreach (var option in sortOptions)
            {
                <a asp-action="Index" 
                   asp-route-sortOrder="@option.Key"
                   class="btn btn-outline-primary @(ViewBag.CurrentSort == option.Key ? "active" : "")">
                    @option.Value
                </a>
            }
        </div>
    </div>

    <ul class="list-group">
        @foreach (var b in Model)
        {
            <li class="list-group-item dynamic-bg d-flex justify-content-between align-items-center flex-wrap">
                <div>
                    <a asp-action="Details" asp-route-id="@b.Id" class="dynamic-link">
                        @b.Title
                        <span class="badge bg-secondary ms-2">@b.Posts.Count posts</span>
                    </a>
                </div>

                @if (b.UserId == UserManager.GetUserId(User) || User.IsInRole("Admin"))
                {
                    <div class="btn-group btn-group-sm mt-2 mt-md-0" role="group">
                        <a asp-action="Edit" asp-route-id="@b.Id" class="btn btn-outline-warning btn-sm">Edit</a>
                        <a asp-action="Delete" asp-route-id="@b.Id" class="btn btn-outline-danger btn-sm">Delete</a>
                    </div>
                }
            </li>
        }
    </ul>
</div>